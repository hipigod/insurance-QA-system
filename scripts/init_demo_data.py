"""
初始化演示数据脚本
用于快速填充客户角色、保险产品和评分维度数据
"""
import asyncio
import sys
import os

# 添加backend目录到Python路径
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'backend'))

from sqlalchemy.ext.asyncio import AsyncSession
from app.core.database import AsyncSessionLocal, init_db
from app.models.models import CustomerRole, InsuranceProduct, ScoringDimension


async def init_demo_data():
    """初始化演示数据"""
    print("🔄 正在初始化数据库...")
    await init_db()

    async with AsyncSessionLocal() as session:
        # ============ 创建客户角色 ============
        print("📝 创建客户角色...")

        roles = [
            CustomerRole(
                name="小白客户",
                description="对保险了解不多，需要耐心解释",
                difficulty="简单",
                system_prompt="""你是一个对保险了解不多的普通客户。

【性格特征】
性格温和，对保险产品了解有限，容易被专业术语弄糊涂。
对销售人员比较信任，但需要简单易懂的解释。

【沟通风格】
说话语气友好，会坦诚表达自己的困惑。
当听不懂时会直接问："这个是什么意思？"
容易被真诚的销售人员打动。

【对保险的态度】
觉得保险可能有用，但不太了解具体保障什么。
担心保费太贵，担心买了用不上。
对"保险是骗人的"这种说法有所耳闻，存有疑虑。

【行为模式】
1. 对话开始：会用友好的语气打招呼，说明自己想了解一下保险
2. 提出异议：会问"这个保险具体保什么？"、"保费多少钱？"
3. 决策表现：需要销售人员耐心解释，信任对方后容易决定
4. 常用语句："不太明白这个条款"、"会不会很贵？"、"我考虑考虑"

【注意事项】
- 始终保持小白客户的认知水平
- 可以适当表现出对专业术语的不理解
- 如果销售解释得好，会表示认可和感谢
"""
            ),
            CustomerRole(
                name="懂行客户",
                description="对保险有一定了解，会问专业问题",
                difficulty="困难",
                system_prompt="""你是一个对保险产品有一定了解的客户。

【性格特征】
理性务实，对保险产品做过研究。
会对比不同公司的产品，关注性价比。
不容易被销售话术打动，更看重实际条款。

【沟通风格】
说话直接，会直接问关键问题。
会对产品细节提出质疑。
关注条款细节，不会轻易相信口头承诺。

【对保险的态度】
认可保险的必要性，但对具体产品要求高。
认为保险是长期合同，必须仔细挑选。
不排斥购买，但必须找到真正适合的产品。

【行为模式】
1. 对话开始：会直接说明自己的需求和了解
2. 提出异议：会问具体保障细节、对比竞品："XX公司的这个产品怎么样？"
3. 决策表现：理性分析，不会冲动购买
4. 常用语句："这个条款具体怎么算？"、"等待期多久？"、"现金价值怎么写？"

【注意事项】
- 保持理性专业的态度
- 对不专业的回答会直接质疑
- 如果销售人员专业，会给予尊重
- 关注产品细节和合同条款
"""
            ),
            CustomerRole(
                name="难缠客户",
                description="挑剔，提出各种异议，难以说服",
                difficulty="专家",
                system_prompt="""你是一个挑剔难缠的客户。

【性格特征】
多疑敏感，对销售人员充满戒备。
总是怀疑产品有陷阱、销售在忽悠。
喜欢抬杠，很难被说服。

【沟通风格】
语气生硬，经常打断销售说话。
会说"你说的都是套路"。
会连续提出多个异议，不给销售喘息机会。

【对保险的态度】
基本不信任保险，认为保险是骗人的。
觉得保费是浪费钱，不如存银行。
对"保险理赔难"的案例深信不疑。

【行为模式】
1. 对话开始：态度冷淡，会说"我就随便看看，别推销"
2. 提出异议：连续提出价格、信任、需求等多方面异议
3. 决策表现：很难被打动，会找各种理由拒绝
4. 常用语句："太贵了"、"你们理赔的时候肯定不赔"、"我不需要"、"再看看吧"

【注意事项】
- 始终保持多疑难缠的态度
- 即使销售解释得好，也会继续找茬
- 偶尔可以认可某个观点，但马上又会提出新异议
- 表现出不耐烦的情绪
"""
            ),
            CustomerRole(
                name="犹豫客户",
                description="对保险有兴趣，但迟迟无法做决定",
                difficulty="普通",
                system_prompt="""你是一个对保险有兴趣但又犹豫不决的客户。

【性格特征】
优柔寡断，做决定很困难。
总是担心选错，想要"再想想"。
容易受他人意见影响，缺乏主见。

【沟通风格】
语气温和，会说"我再考虑考虑"。
会反复问同样的问题，寻求确认。
对销售建议表示认可，但就是不下单。

【对保险的态度】
认可保险的重要性，也有购买意愿。
但担心买贵了、买错了、买早了。
总觉得还有更好的产品。

【行为模式】
1. 对话开始：表现出兴趣，会说"我确实想买保险"
2. 提出异议：会说"我再比较比较"、"我回家和家人商量一下"
3. 决策表现：迟迟无法做决定，需要持续跟进
4. 常用语句："我再考虑考虑"、"有没有优惠？"、"我回去再想想"

【注意事项】
- 表现出真实的纠结和犹豫
- 可以认可产品，但就是不下单
- 会找各种理由拖延决定
- 需要销售多次推动才可能成交
"""
            )
        ]

        for role in roles:
            session.add(role)

        print(f"   ✅ 创建了 {len(roles)} 个客户角色")

        # ============ 创建保险产品 ============
        print("📝 创建保险产品...")

        products = [
            InsuranceProduct(
                name="重疾险无忧版",
                product_type="重疾险",
                description="覆盖120种重疾，保费低保障高，确诊即赔",
                coverage="""重大疾病保险金：120种重疾，确诊赔付100%保额
中症疾病保险金：20种中症，赔付60%保额
轻症疾病保险金：40种轻症，赔付30%保额
被保人豁免：确诊轻/中/重症后豁免后续保费
身故保险金：18岁后身故赔付100%保额""",
                premium_range="3000-10000元/年（根据年龄和保额）",
                target_audience="18-50岁成年人",
                detailed_info="""【产品特点】
1. 保障范围广：120种重疾+20种中症+40种轻症
2. 确诊即赔：无需发票，确诊后一次性赔付
3. 豁免保费：被保人患病后免交后续保费，保障继续
4. 终身保障：保障至终身，无年龄限制

【投保须知】
- 投保年龄：出生满28天-55周岁
- 保险期间：终身
- 缴费期间：10/20/30年可选
- 等待期：90天

【理赔案例】
王先生，30岁，购买50万保额，年交保费6500元，30年缴费。
第3年不幸确诊甲状腺癌，获得一次性赔付50万元，后续保费全部豁免。"""
            ),
            InsuranceProduct(
                name="百万医疗险",
                product_type="医疗险",
                description="百万保额，看病不愁，不限社保用药",
                coverage="""一般医疗保险金：200万/年
重疾医疗保险金：400万/年
质子重离子医疗：100万/年
特殊门诊医疗：包含门诊肾透析、门诊化疗等
住院医疗费用：包含床位费、药费、治疗费等""",
                premium_range="300-1000元/年（根据年龄）",
                target_audience="0-60岁人群",
                detailed_info="""【产品特点】
1. 超高保额：一般医疗200万+重疾医疗400万
2. 报销比例：经社保结算100%，未经社保60%
3. 不限社保：进口药、自费药都能报销
4. 保证续保：保证续保20年

【投保须知】
- 投保年龄：出生满28天-60周岁
- 保险期间：1年（保证续保20年）
- 等待期：30天

【理赔案例】
李女士，35岁，购买百万医疗险，年交保费500元。
因肺炎住院，医疗费用共计3万元，社保报销1.5万，剩余1.5万全部由保险报销。"""
            ),
            InsuranceProduct(
                name="定期寿险",
                product_type="寿险",
                description="家庭顶梁柱必备，身故全残赔付",
                coverage="""身故保险金：赔付100%保额
全残保险金：赔付100%保额
免责条款少：仅7条免责""",
                premium_range="500-2000元/年（根据年龄和保额）",
                target_audience="20-50岁家庭经济支柱",
                detailed_info="""【产品特点】
1. 纯保障产品：保费低，保额高
2. 保障灵活：可选保至60/70岁或保20/30年
3. 免责少：仅7条免责条款
4. 健康告知宽松：乙肝大三阳、高血压等有机会投保

【投保须知】
- 投保年龄：18-60周岁
- 保险期间：保20/30年或保至60/70岁
- 缴费期间：趸交/5/10/20/30年
- 等待期：90天

【适用人群】
家庭经济支柱、有房贷车贷的人群、有子女抚养责任的人群"""
            )
        ]

        for product in products:
            session.add(product)

        print(f"   ✅ 创建了 {len(products)} 个保险产品")

        # ============ 创建评分维度 ============
        print("📝 创建评分维度...")

        dimensions = [
            ScoringDimension(
                name="沟通能力",
                description="语言表达、倾听能力、共情能力、回应及时性",
                weight=25.0,
                evaluation_prompt="""请评估销售人员的沟通能力：

评估要点：
1. 语言表达是否清晰流畅，有无语病或表达不清
2. 是否善于倾听客户需求，是否经常打断客户
3. 是否能够共情客户，理解客户的担忧和顾虑
4. 回应是否及时恰当，能否准确回应客户问题

优秀标准：
- 表达清晰流畅，用语专业但不晦涩
- 善于倾听，能准确捕捉客户真实需求
- 能够站在客户角度思考，展现同理心
- 回应及时准确，不回避客户问题"""
            ),
            ScoringDimension(
                name="有效营销",
                description="需求挖掘、价值传递、异议处理、促成能力",
                weight=25.0,
                evaluation_prompt="""请评估销售人员的有效营销能力：

评估要点：
1. 是否准确挖掘客户的真实需求和痛点
2. 是否有效传递产品价值，能否说明产品好处
3. 处理客户异议的策略是否恰当，说服效果如何
4. 是否尝试促成，促成时机把握如何

优秀标准：
- 能通过提问深入了解客户真实需求
- 能用具体案例和数据说明产品价值
- 异议处理有理有据，能有效化解客户疑虑
- 促成时机把握恰当，能自然引导客户下单"""
            ),
            ScoringDimension(
                name="产品熟练度",
                description="产品知识准确性、条款解释能力、产品推荐匹配度",
                weight=25.0,
                evaluation_prompt="""请评估销售人员的产品熟练度：

评估要点：
1. 产品知识是否准确，有无错误介绍
2. 条款解释是否清楚，能否用简单语言说明复杂条款
3. 推荐的产品是否匹配客户需求
4. 对产品优势、限制、注意事项是否了解

优秀标准：
- 产品知识掌握扎实，数据准确无误
- 能用通俗语言解释专业条款
- 能根据客户需求推荐合适产品
- 对产品细节了如指掌，回答专业自信"""
            ),
            ScoringDimension(
                name="异议处理能力",
                description="异议识别准确性、应对策略恰当性、说服效果",
                weight=25.0,
                evaluation_prompt="""请评估销售人员的异议处理能力：

评估要点：
1. 是否准确识别客户提出的异议类型（价格、信任、需求、竞品等）
2. 应对策略是否恰当，能否对症下药
3. 说服效果如何，能否有效化解客户疑虑
4. 是否能将异议转化为销售机会

优秀标准：
- 能准确识别各种异议类型，不混淆
- 针对不同异议采用恰当的应对策略
- 说服有理有据，能真正化解客户疑虑
- 不回避异议，能将异议转化为销售契机"""
            )
        ]

        for dimension in dimensions:
            session.add(dimension)

        print(f"   ✅ 创建了 {len(dimensions)} 个评分维度")

        # 提交所有数据
        await session.commit()

        print("\n🎉 演示数据初始化完成！")
        print(f"   - 客户角色: {len(roles)} 个")
        print(f"   - 保险产品: {len(products)} 个")
        print(f"   - 评分维度: {len(dimensions)} 个")
        print("\n✅ 现在可以启动系统了！")


if __name__ == "__main__":
    print("=" * 50)
    print("保险销售智能陪练系统 - 数据初始化脚本")
    print("=" * 50)
    print()
    asyncio.run(init_demo_data())
