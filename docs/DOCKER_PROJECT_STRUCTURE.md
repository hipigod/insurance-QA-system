# ğŸ—ï¸ DockeråŒ–é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### æ ¹ç›®å½•æ–°å¢æ–‡ä»¶

```
Insurance Q&A System/
â”œâ”€â”€ docker-compose.yml          â­ DockeræœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ .env.example                â­ ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .dockerignore               â­ Dockeræ„å»ºå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ DOCKER_DEPLOYMENT.md        â­ å®Œæ•´éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ deploy.sh                   â­ Linux/Macéƒ¨ç½²è„šæœ¬
â””â”€â”€ deploy.bat                  â­ Windowséƒ¨ç½²è„šæœ¬
```

### Backendç›®å½•æ–°å¢æ–‡ä»¶

```
backend/
â”œâ”€â”€ Dockerfile                  â­ åç«¯é•œåƒæ„å»ºæ–‡ä»¶
â””â”€â”€ .dockerignore               â­ åç«¯æ„å»ºå¿½ç•¥æ–‡ä»¶
```

### Frontendç›®å½•æ–°å¢æ–‡ä»¶

```
frontend/
â”œâ”€â”€ Dockerfile                  â­ å‰ç«¯é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ nginx.conf                  â­ Nginxåå‘ä»£ç†é…ç½®
â””â”€â”€ .dockerignore               â­ å‰ç«¯æ„å»ºå¿½ç•¥æ–‡ä»¶
```

---

## ğŸ”§ æ–‡ä»¶åŠŸèƒ½è¯´æ˜

### 1. docker-compose.yml

**åŠŸèƒ½**: å®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨

**æœåŠ¡é…ç½®**:
- `backend`: åç«¯APIæœåŠ¡
  - é•œåƒ: python:3.9-slim
  - ç«¯å£: 8000
  - ç¯å¢ƒ: AIæ¨¡å‹é…ç½®ã€æ•°æ®åº“é…ç½®ç­‰
  - å·: ./backend/data:/app/data

- `frontend`: å‰ç«¯WebæœåŠ¡
  - é•œåƒ: nginx:alpine
  - ç«¯å£: 80
  - ä¾èµ–: backendæœåŠ¡å¥åº·æ£€æŸ¥é€šè¿‡åæ‰å¯åŠ¨

**ç½‘ç»œé…ç½®**:
- è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œ: insurance-network
- å­ç½‘: 172.20.0.0/16

### 2. .env.example

**åŠŸèƒ½**: ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

**å¿…å¡«é…ç½®**:
- `MODEL_API_KEY`: AIæ¨¡å‹APIå¯†é’¥

**å¯é€‰é…ç½®**:
- `DEFAULT_MODEL`: ä½¿ç”¨çš„AIæ¨¡å‹ï¼ˆé»˜è®¤: deepseek-chatï¼‰
- `MODEL_API_BASE`: APIåŸºç¡€URL
- `AI_RESPONSE_TIMEOUT`: AIå“åº”è¶…æ—¶æ—¶é—´
- `AI_TEMPERATURE`: AIåˆ›æ„åº¦

### 3. åç«¯ Dockerfile

**åŠŸèƒ½**: æ„å»ºåç«¯Dockeré•œåƒ

**æ„å»ºæ­¥éª¤**:
1. ä½¿ç”¨python:3.9-slimåŸºç¡€é•œåƒ
2. å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆgccï¼‰
3. å®‰è£…Pythonä¾èµ–ï¼ˆrequirements.txtï¼‰
4. å¤åˆ¶é¡¹ç›®ä»£ç 
5. åˆ›å»ºdataç›®å½•
6. æš´éœ²8000ç«¯å£
7. å¯åŠ¨main.py

**ä¼˜åŒ–ç‚¹**:
- ä½¿ç”¨slimé•œåƒå‡å°ä½“ç§¯
- æ¸…ç†aptç¼“å­˜
- è®¾ç½®Pythonç¯å¢ƒå˜é‡ä¼˜åŒ–æ€§èƒ½

### 4. å‰ç«¯ Dockerfile

**åŠŸèƒ½**: æ„å»ºå‰ç«¯Dockeré•œåƒï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰

**æ„å»ºé˜¶æ®µ** (builder):
1. ä½¿ç”¨node:18-alpineåŸºç¡€é•œåƒ
2. å®‰è£…npmä¾èµ–
3. æ„å»ºVueåº”ç”¨ï¼ˆnpm run buildï¼‰

**ç”Ÿäº§é˜¶æ®µ** (nginx):
1. ä½¿ç”¨nginx:alpineåŸºç¡€é•œåƒ
2. å¤åˆ¶æ„å»ºäº§ç‰©åˆ°nginxç›®å½•
3. å¤åˆ¶nginxé…ç½®
4. é…ç½®å¥åº·æ£€æŸ¥
5. æš´éœ²80ç«¯å£

**ä¼˜åŒ–ç‚¹**:
- ä½¿ç”¨Node.js 18è§£å†³cryptoå…¼å®¹æ€§é—®é¢˜
- å¤šé˜¶æ®µæ„å»ºå‡å°æœ€ç»ˆé•œåƒä½“ç§¯
- è®¾ç½®æ–‡ä»¶æƒé™

### 5. nginx.conf

**åŠŸèƒ½**: NginxæœåŠ¡å™¨é…ç½®

**é…ç½®è¦ç‚¹**:
- é™æ€æ–‡ä»¶æœåŠ¡
- APIåå‘ä»£ç†ï¼ˆ/api -> backend:8000ï¼‰
- WebSocketä»£ç†ï¼ˆ/ws -> backend:8000ï¼‰
- Gzipå‹ç¼©
- é™æ€èµ„æºç¼“å­˜
- å®‰å…¨å¤´è®¾ç½®

### 6. .dockerignoreæ–‡ä»¶

**åŠŸèƒ½**: æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦

**æ’é™¤å†…å®¹**:
- Gitæ–‡ä»¶
- æ–‡æ¡£æ–‡ä»¶
- IDEé…ç½®
- ä¸´æ—¶æ–‡ä»¶
- æ•°æ®æ–‡ä»¶

### 7. éƒ¨ç½²è„šæœ¬

**deploy.sh (Linux/Mac)**:
- è‡ªåŠ¨æ£€æŸ¥Dockerç¯å¢ƒ
- è‡ªåŠ¨åˆ›å»º.envæ–‡ä»¶
- è‡ªåŠ¨æ„å»ºå’Œå¯åŠ¨æœåŠ¡
- æ˜¾ç¤ºéƒ¨ç½²ä¿¡æ¯

**deploy.bat (Windows)**:
- Windowsæ‰¹å¤„ç†ç‰ˆæœ¬
- åŠŸèƒ½åŒdeploy.sh

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

**Linux/Mac**:
```bash
chmod +x deploy.sh
./deploy.sh
```

**Windows**:
```cmd
deploy.bat
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env  # ç¼–è¾‘API_KEY

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## ğŸ“Š é•œåƒä¿¡æ¯

### åç«¯é•œåƒ

- **åç§°**: insurance-backend
- **åŸºç¡€é•œåƒ**: python:3.9-slim
- **å¤§å°**: ~150MB
- **ç«¯å£**: 8000
- **ä¾èµ–**: PythonåŒ…ï¼ˆFastAPIã€uvicornã€openaiç­‰ï¼‰

### å‰ç«¯é•œåƒ

- **åç§°**: insurance-frontend
- **åŸºç¡€é•œåƒ**: nginx:alpine
- **å¤§å°**: ~30MB
- **ç«¯å£**: 80
- **åŒ…å«**: Vue 3æ„å»ºäº§ç‰©

---

## ğŸ” ç½‘ç»œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Network                â”‚
â”‚     insurance-network (172.20.0.0/16)   â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Frontend   â”‚      â”‚    Backend   â”‚ â”‚
â”‚  â”‚   nginx:80   â”‚â”€â”€â”€â”€â”€â–¶â”‚ python:8000  â”‚ â”‚
â”‚  â”‚              â”‚      â”‚              â”‚ â”‚
â”‚  â”‚ Port: 80     â”‚      â”‚ Port: 8000   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†“                      â†“         â”‚
â”‚    å®¿ä¸»æœº:80              å®¿ä¸»æœº:8000     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€šä¿¡æµç¨‹**:
1. ç”¨æˆ·è®¿é—® â†’ Frontend (nginx:80)
2. Frontendä»£ç† /api â†’ Backend (python:8000)
3. Frontendä»£ç† /ws â†’ Backend (WebSocket)
4. Backendè°ƒç”¨AIæ¨¡å‹API (å¤–ç½‘)

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### æ•°æ®å·æ˜ å°„

```yaml
volumes:
  - ./backend/data:/app/data
```

**æŒä¹…åŒ–å†…å®¹**:
- SQLiteæ•°æ®åº“æ–‡ä»¶
- å¯¹è¯è®°å½•
- ç»ƒä¹ è®°å½•

### å¤‡ä»½ç­–ç•¥

```bash
# å¤‡ä»½æ•°æ®åº“
cp backend/data/insurance_practice.db backups/backup_$(date +%Y%m%d).db
```

---

## ğŸ› ï¸ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
docker-compose ps
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æ‰€æœ‰æœåŠ¡
docker-compose logs -f

# ç‰¹å®šæœåŠ¡
docker-compose logs -f backend
docker-compose logs -f frontend
```

### é‡å¯æœåŠ¡

```bash
# æ‰€æœ‰æœåŠ¡
docker-compose restart

# ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### åœæ­¢æœåŠ¡

```bash
docker-compose stop
```

### åˆ é™¤å®¹å™¨

```bash
docker-compose down
```

### é‡æ–°æ„å»º

```bash
docker-compose build --no-cache
docker-compose up -d
```

### è¿›å…¥å®¹å™¨

```bash
# åç«¯
docker exec -it insurance-backend bash

# å‰ç«¯
docker exec -it insurance-frontend sh
```

---

## ğŸ”§ é…ç½®ä¿®æ”¹

### ä¿®æ”¹ç«¯å£æ˜ å°„

ç¼–è¾‘ `docker-compose.yml`:

```yaml
services:
  backend:
    ports:
      - "8001:8000"  # ä¿®æ”¹å¤–éƒ¨ç«¯å£

  frontend:
    ports:
      - "8080:80"    # ä¿®æ”¹å¤–éƒ¨ç«¯å£
```

### ä¿®æ”¹èµ„æºé™åˆ¶

ç¼–è¾‘ `docker-compose.yml`:

```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
```

### æ·»åŠ ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶æˆ– `docker-compose.yml`:

```yaml
services:
  backend:
    environment:
      - NEW_VAR=value
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ

**å¼€å‘ç¯å¢ƒ**:
- ä½¿ç”¨ `.env` é…ç½®
- DEBUG=True
- æŒ‚è½½æºä»£ç å·ï¼ˆçƒ­é‡è½½ï¼‰

**ç”Ÿäº§ç¯å¢ƒ**:
- ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶
- DEBUG=False
- ä¸æŒ‚è½½æºä»£ç 
- é…ç½®èµ„æºé™åˆ¶
- å¯ç”¨æ—¥å¿—è½®è½¬

### å®‰å…¨å»ºè®®

1. âœ… ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°Git
2. âœ… ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
3. âœ… å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
4. âœ… é…ç½®é˜²ç«å¢™è§„åˆ™
5. âœ… å¯ç”¨HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### æ€§èƒ½ä¼˜åŒ–

1. âœ… ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒä½“ç§¯
2. âœ… é…ç½®åˆé€‚çš„èµ„æºé™åˆ¶
3. âœ… å¯ç”¨Nginx gzipå‹ç¼©
4. âœ… é…ç½®é™æ€èµ„æºç¼“å­˜
5. âœ… ä½¿ç”¨å¥åº·æ£€æŸ¥è‡ªåŠ¨é‡å¯

---

## ğŸ› æ•…éšœæ’æŸ¥

### å®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs backend
docker-compose logs frontend
```

### ç½‘ç»œè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥ç½‘ç»œ
docker network inspect insurance-network

# æµ‹è¯•è¿é€šæ€§
docker exec insurance-frontend ping backend
```

### æ•°æ®ä¸¢å¤±

```bash
# æ£€æŸ¥å·æ˜ å°„
docker volume inspect insurance-q-a-system_backend_data

# æ¢å¤å¤‡ä»½
cp backups/backup_xxx.db backend/data/insurance_practice.db
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Dockeréƒ¨ç½²å®Œæ•´æŒ‡å—](DOCKER_DEPLOYMENT.md)
- [Dockeréƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ](Dockeréƒ¨ç½²æƒé™é—®é¢˜è§£å†³æ–¹æ¡ˆ.md)
- [é¡¹ç›®README](README.md)
- [äº§å“éœ€æ±‚æ–‡æ¡£](PRD-ä¿é™©é”€å”®æ™ºèƒ½é™ªç»ƒç³»ç»Ÿdemo-V1.2.md)

---

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| V0.2.2 | 2026-01-05 | æ–°å¢å®Œæ•´çš„DockeråŒ–é…ç½® |

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0
**æœ€åæ›´æ–°**: 2026-01-05
**ç»´æŠ¤äººå‘˜**: é¡¹ç›®å¼€å‘ç»„
